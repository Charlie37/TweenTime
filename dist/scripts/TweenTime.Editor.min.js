!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash"),require(void 0),require("d3"),require("jquery"),require("DraggableNumber"),require("spectrum")):"function"==typeof define&&define.amd?define(["lodash","signals","d3","jquery","DraggableNumber","spectrum"],e):"object"==typeof exports?exports.Editor=e(require("lodash"),require("./signals"),require("d3"),require("jquery"),require("DraggableNumber"),require("spectrum")):(t.TweenTime=t.TweenTime||{},t.TweenTime.Editor=e(t._,t.signals,t.d3,t.$,t.DraggableNumber,t.spectrum))}(this,function(t,e,i,n,r,a){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n=i(16),r=i(5)["default"],a=i(6)["default"],s=i(7)["default"],o=i(8)["default"],l=i(9)["default"],c=i(10)["default"],u=i(11)["default"],h=function(){var t=function(t,e){var i=this;void 0===e&&(e={}),this.tweenTime=t,this.options=e,this.timer=this.tweenTime.timer,this.lastTime=-1,this.onKeyAdded=this.onKeyAdded.bind(this),this.onKeyRemoved=this.onKeyRemoved.bind(this),this.$timeline=$(n()),$("body").append(this.$timeline),$("body").addClass("has-editor"),this.selectionManager=new l(this.tweenTime),this.exporter=new c(this),this.timeline=new r(this,e),this.propertiesEditor=new a(this,this.selectionManager),this.propertiesEditor.keyAdded.add(this.onKeyAdded),this.propertiesEditor.keyRemoved.add(this.onKeyRemoved),this.menu=new s(this.tweenTime,this.$timeline,this),null!=this.options.onMenuCreated&&this.options.onMenuCreated(this.$timeline.find(".timeline__menu")),this.controls=new o(this.tweenTime,this.$timeline),this.undoManager=new u(this),window.editorEnabled=!0,window.dispatchEvent(new Event("resize")),window.requestAnimationFrame(function(){return i.update()})};return t.prototype.onKeyAdded=function(){this.undoManager.addState(),this.render(!1,!0)},t.prototype.onKeyRemoved=function(t){this.selectionManager.removeItem(t),this.undoManager.addState(),this.selectionManager.selection.length&&this.selectionManager.triggerSelect(),this.render(!1,!0)},t.prototype.render=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),t===!1&&(t=this.timer.time[0]),e&&(this.timeline._isDirty=!0),this.timeline.render(t,e),this.controls.render(t,e),this.propertiesEditor.render(t,e)},t.prototype.update=function(){var t=this,e=this.timer.time[0],i=this.lastTime===e?!1:!0;this.render(e,i),this.lastTime=this.timer.time[0],window.requestAnimationFrame(function(){return t.update()})},t}();t.exports=h},function(e){e.exports=t},function(t,e){"use strict";var i=function(){var t=function(){};return t.formatMinutes=function(t){t/=1e3;var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),n=t-60*i,r=n+"s";return i&&(r=i+"m "+r),e&&(r=e+"h "+r),r},t.getClosestTime=function(t,e,i,n,r,a){if(void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=.1),r){var s=r.getCurrentTime()/1e3;if(Math.abs(s-e)<=a)return s}if(i||n)for(var o=0;o<t.length;o++){var l=t[o];if(l.id!=i||n){if(Math.abs(l.start-e)<=a)return l.start;if(Math.abs(l.end-e)<=a)return l.end}for(var c=0;c<l.properties.length;c++){var u=l.properties[c];if(u.keys&&(l.id!=i||u.name!=n))for(var h=0;h<u.keys;h++){var p=u.keys[h];if(Math.abs(p.time-e)<=a)return p.time}}}return!1},t.getPreviousKey=function(t,e){for(var i=!1,n=0;n<t.length;n++){var r=t[n];if(!(r.time<e))return i;i=r}return i},t.sortKeys=function(t){var e=function(t,e){return t.time<e.time?-1:t.time>e.time?1:0};return t.sort(e)},t.guid=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t}();e["default"]=i},,,function(t,e,i){"use strict";var n=i(14),r=i(2)["default"],a=i(17)["default"],s=i(18)["default"],o=i(19)["default"],l=i(20)["default"],c=i(21)["default"],u=i(22)["default"],h=i(23)["default"],p=i(24)["default"],d=function(){var t=function(t,e){var i=this;this.editor=t,this.tweenTime=this.editor.tweenTime,this.timer=this.tweenTime.timer,this.selectionManager=this.editor.selectionManager,this._isDirty=!0,this.timer=this.tweenTime.timer,this.currentTime=this.timer.time,this.initialDomain=[],this.initialDomain[0]=e.domainStart||0,this.initialDomain[1]=e.domainEnd||.2*this.timer.totalDuration,this.initialDomain[0]>this.timer.getCurrentTime()&&(this.timer.time[0]=this.initialDomain[0]);var d={top:6,right:20,bottom:0,left:265};this.margin=d;var f=window.innerWidth-d.left-d.right,m=270-d.top-d.bottom-40;this.lineHeight=20,this.label_position_x=-d.left+20,this.x=n.time.scale().domain(this.initialDomain).range([0,f]),this.xAxis=n.svg.axis().scale(this.x).orient("top").tickSize(-m,0).tickFormat(r.formatMinutes),this.svg=n.select(".timeline__main").append("svg").attr("width",f+d.left+d.right).attr("height",600),this.svgContainer=this.svg.append("g").attr("transform","translate("+d.left+","+d.top+")"),this.svgContainerTime=this.svg.append("g").attr("transform","translate("+d.left+",0)"),this.linesContainer=this.svg.append("g").attr("transform","translate("+d.left+","+d.top+")"),this.header=new a(this.timer,this.initialDomain,this.tweenTime,f,d),this.timeIndicator=new s(this,this.svgContainerTime),this.selection=new p(this,this.svg,d),this.items=new o(this,this.linesContainer),this.items.onUpdate.add(this.onUpdate),this.keysPreview=new l(this,this.linesContainer),this.properties=new c(this),this.properties.onKeyAdded.add(function(t,e){i._isDirty=!0,i.render(0,!1),i.keys.selectNewKey(t,e)}),this.errors=new h(this),this.keys=new u(this),this.keys.onKeyUpdated.add(function(){i.onUpdate()}),this.xAxisGrid=n.svg.axis().scale(this.x).ticks(100).tickSize(-this.items.dy,0).tickFormat("").orient("top"),this.xGrid=this.svgContainer.append("g").attr("class","x axis grid").attr("transform","translate(0,"+d.top+")").call(this.xAxisGrid),this.xAxisElement=this.svgContainer.append("g").attr("class","x axis").attr("transform","translate(0,"+d.top+")").call(this.xAxis),this.header.onBrush.add(function(t){i.x.domain(t),i.xGrid.call(i.xAxisGrid),i.xAxisElement.call(i.xAxis),i._isDirty=!0}),window.requestAnimationFrame(function(){i.render()}),window.onresize=function(){var t=window.innerWidth,e=t-d.left-d.right;i.svg.attr("width",e+d.left+d.right),i.svg.selectAll(".timeline__right-mask").attr("width",t),i.x.range([0,e]),i._isDirty=!0,i.header.resize(t),i.render()}};return t.prototype.onUpdate=function(){this.editor.render(!1,!0)},t.prototype.render=function(t,e){if(e){var i=16;if(this.timer.getCurrentTime()>this.initialDomain[1]){var n=this.initialDomain[1]-this.initialDomain[0];this.initialDomain[0]+=n-i,this.initialDomain[1]+=n-i,this.header.setDomain(this.initialDomain)}if(this.timer.getCurrentTime()<this.initialDomain[0]){var n=this.initialDomain[1]-this.initialDomain[0];this.initialDomain[0]=this.timer.getCurrentTime(),this.initialDomain[1]=this.initialDomain[0]+n,this.header.setDomain(this.initialDomain)}}if((this._isDirty||e)&&(this.header.render(),this.timeIndicator.render()),this._isDirty){var r=this.items.render();this.keysPreview.render(r);var a=this.properties.render(r);this.errors.render(a),this.keys.render(a),this._isDirty=!1;var s=Math.max(this.items.dy+30,230);this.xAxis.tickSize(-s,0),this.xAxisGrid.tickSize(-s,0),this.xGrid.call(this.xAxisGrid),this.xAxisElement.call(this.xAxis),this.svg.attr("height",s)}},t}();e["default"]=d},function(t,e,i){"use strict";var n=i(15),r=i(12),a=i(25)["default"],s=i(26),o=function(){var t=function(t){this.editor=t,this.render=this.render.bind(this),this.addProperty=this.addProperty.bind(this),this.onSelect=this.onSelect.bind(this),this.onKeyAdded=this.onKeyAdded.bind(this),this.timeline=this.editor.timeline,this.timer=this.editor.timer,this.selectionManager=t.selectionManager,this.$el=n(s()),this.$container=this.$el.find(".properties-editor__main"),this.keyAdded=new r.Signal,this.keyRemoved=new r.Signal,this.items=[],n("body").addClass("properties-is-closed"),n("body").append(this.$el),this.selectionManager.onSelect.add(this.onSelect),this.$el.keypress(function(t){return t.stopPropagation()})};return t.prototype.onKeyAdded=function(){this.keyAdded.dispatch()},t.prototype.onSelect=function(t){if(void 0===t&&(t=!1),this.items=[],this.$container.empty(),t instanceof Array)for(var e=0;e<t.length;e++){var i=t[e];this.addProperty(i)}else this.addProperty(t);this.items.length&&n("body").removeClass("properties-is-closed")},t.prototype.addProperty=function(t){var e=new a(this.editor,this.$container,t);e.keyAdded.add(this.onKeyAdded),this.items.push(e)},t.prototype.render=function(t,e){if(e)for(var i=0;i<this.items.length;i++){var n=this.items[i];n.update()}},t}();e["default"]=o},function(t,e,i){"use strict";var n=i(27),r=function(){var t=function(t,e,i){this.tweenTime=t,this.$timeline=e,this.editor=i,this.timer=this.tweenTime.timer,this.initExport(),this.initToggle()};return t.prototype.initToggle=function(){var t=!1,e=this.$timeline.find('[data-action="toggle"]');e.click(function(i){return i.preventDefault(),t=!t,e.toggleClass("menu-item--toggle-up",t),$("body").toggleClass("timeline-is-closed",t),window.dispatchEvent(new Event("resize"))});var i=$(".properties-editor").find('[data-action="toggle"]');i.click(function(t){var e;return t.preventDefault(),e=!$("body").hasClass("properties-is-closed"),$("body").toggleClass("properties-is-closed",e),window.dispatchEvent(new Event("resize"))})},t.prototype.initExport=function(){var t=this.editor.exporter;this.$timeline.find('[data-action="export"]').click(function(e){e.preventDefault();var i=t.getJSON(),r=new Blob([i],{type:"text/json;charset=utf-8"});n(r,"data.json")})},t}();e["default"]=r},function(t,e){"use strict";var i=function(){var t=function(t,e){var i=this;this.tweenTime=t,this.$timeline=e,this.timer=this.tweenTime.timer,this.$time=this.$timeline.find(".control--time"),this.$time_end=this.$timeline.find(".control--time-end"),this.initControls(),this.$time_end.val(this.tweenTime.timer.getDuration()),$(document).keypress(function(t){32==t.charCode&&i.playPause()})};return t.prototype.playPause=function(){var t;this.timer.toggle(),t=this.$timeline.find(".control--play-pause"),t.toggleClass("icon-pause",this.timer.is_playing),t.toggleClass("icon-play",!this.timer.is_playing)},t.prototype.initControls=function(){var t=this,e=this.$timeline.find(".control--play-pause");e.click(function(e){e.preventDefault(),t.playPause()});var i=this.$timeline.find(".control--first");i.click(function(e){e.preventDefault(),t.timer.seek([0])});var n=this.$timeline.find(".control--last");n.click(function(e){e.preventDefault();var i=t.tweenTime.getTotalDuration();t.timer.seek([1e3*i])}),this.$time.change(function(){var e=1e3*parseFloat(t.$time.val(),10);t.timer.seek([e])}),this.$time_end.change(function(){var e=parseFloat(t.$time_end.val(),10);t.timer.setDuration(e)})},t.prototype.render=function(t,e){if(e){var i=t/1e3;this.$time.val(i.toFixed(3))}},t}();e["default"]=i},function(t,e,i){"use strict";var n=i(14),r=i(12),a=function(){var t=function(t){this.tweenTime=t,this.selection=[],this.onSelect=new r.Signal};return t.prototype.removeDuplicates=function(){for(var t=[],e=0;e<this.selection.length;e++){for(var i=this.selection[e],n=!1,r=0;r<t.length;r++){var a=t[r];if(i.isEqualNode(a)){n=!0;break}}n===!1&&t.push(i)}this.selection=t},t.prototype.removeItem=function(t){var e=this.selection.indexOf(t);e>-1&&this.selection.splice(e,1)},t.prototype.sortSelection=function(){var t=function(t,e){return t.__data__&&e.__data__?t.__data__.time<e.__data__.time?-1:t.__data__.time>e.__data__.time?1:0:0};this.selection=this.selection.sort(t)},t.prototype.reset=function(){this.selection=[],this.highlightItems(),this.onSelect.dispatch(this.selection,!1)},t.prototype.triggerSelect=function(){this.onSelect.dispatch(this.selection,!1)},t.prototype.select=function(t,e){if(void 0===e&&(e=!1),e||(this.selection=[]),t instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];this.selection.push(n)}else this.selection.push(t);this.removeDuplicates(),this.highlightItems(),this.sortSelection(),this.onSelect.dispatch(this.selection,e)},t.prototype.getSelection=function(){return this.selection},t.prototype.highlightItems=function(){n.selectAll(".bar--selected").classed("bar--selected",!1),n.selectAll(".key--selected").classed("key--selected",!1);for(var t=0;t<this.selection.length;t++){var e=this.selection[t],i=n.select(e);i.classed("bar")?i.classed("bar--selected",!0):i.classed("key")&&i.classed("key--selected",!0)}},t}();e["default"]=a},function(t,e){"use strict";var i=function(){var t=function(t){this.editor=t};return t.prototype.getData=function(){var t=this.editor.tweenTime,e=this.editor.timeline.x.domain(),i=e[0],n=e[1];return{settings:{time:t.timer.getCurrentTime(),duration:t.timer.getDuration(),domain:[i.getTime(),n.getTime()]},data:t.data}},t.prototype.getJSON=function(){var t=this.editor.options,e=function(e,i){return 0===e.indexOf("_")?void 0:null!=t.json_replacer?t.json_replacer(e,i):i};return data=this.getData(),JSON.stringify(data,e,2)},t}();e["default"]=i},function(t,e,i){"use strict";var n=i(15),r=function(){var t=function(t){var e=this;this.editor=t,this.history_max=100,this.history=[],this.current_index=0,this.addState(),n(document).keydown(function(t){90==t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.shiftKey?e.redo():e.undo())})};return t.prototype.undo=function(){return this.current_index<=0?!1:(this.current_index-=1,void this.setState(this.current_index))},t.prototype.redo=function(){return this.current_index>=this.history.length-1?!1:(this.current_index+=1,void this.setState(this.current_index))},t.prototype.addState=function(){var t=JSON.parse(this.editor.exporter.getJSON());this.current_index+1<this.history.length&&this.history.splice(this.current_index+1,this.history.length-1),this.history.push(t),this.history.length>this.history_max&&this.history.shift(),this.current_index=this.history.length-1},t.prototype.setState=function(t){for(var e=this.history[t],i=e.data,n=this.editor.tweenTime,r=0;r<i.length;r++){var a=i[r];if(n.data[r])for(var s=0;s<a.properties.length;s++){var o=a.properties[s];if(n.data[r].properties[s])for(var l=n.data[r].properties[s].keys,c=0;c<o.keys.length;c++){var u=o.keys[c];l[c]?(l[c].time=u.time,l[c].val=u.val,l[c].ease=u.ease):l[c]=u}else n.data[r].properties[s]=o}else n.data[r]=a;n.data[r]._isDirty=!0}this.editor.render(!1,!0)},t}();e["default"]=r},function(t){t.exports=e},,function(t){t.exports=i},function(t){t.exports=n},function(t,e,i){var n=i(37);t.exports=function(){var t=new n.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.b('<div class="timeline">'),n.b("\n"+i),n.b('  <nav class="timeline__menu">'),n.b("\n"+i),n.b('    <a href="#" class="menu-item" data-action="export">Export</a>'),n.b("\n"+i),n.b('    <a href="#" class="menu-item menu-item--toggle" data-action="toggle"><i class="icon-toggle"></i></a>'),n.b("\n"+i),n.b("  </nav>"),n.b("\n"+i),n.b('  <div class="timeline__controls controls">'),n.b("\n"+i),n.b('    <a href="#" class="control control--first icon-first"></a>'),n.b("\n"+i),n.b('    <a href="#" class="control control--play-pause icon-play"></a>'),n.b("\n"+i),n.b('    <a href="#" class="control control--last icon-last"></a>'),n.b("\n"+i),n.b('    <input type="text" class="control control--input control--time" /> <span class="control__time-separator">/</span> <input type="text" class="control control--input control--time-end" />'),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b('  <div class="timeline__header">'),n.b("\n"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b('  <div class="timeline__main">'),n.b("\n"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="timeline">\n  <nav class="timeline__menu">\n    <a href="#" class="menu-item" data-action="export">Export</a>\n    <a href="#" class="menu-item menu-item--toggle" data-action="toggle"><i class="icon-toggle"></i></a>\n  </nav>\n  <div class="timeline__controls controls">\n    <a href="#" class="control control--first icon-first"></a>\n    <a href="#" class="control control--play-pause icon-play"></a>\n    <a href="#" class="control control--last icon-last"></a>\n    <input type="text" class="control control--input control--time" /> <span class="control__time-separator">/</span> <input type="text" class="control control--input control--time-end" />\n  </div>\n  <div class="timeline__header">\n\n  </div>\n  <div class="timeline__main">\n\n  </div>\n</div>\n',n);return t.render.apply(t,arguments)}},function(t,e,i){"use strict";var n=i(14),r=i(12),a=i(2)["default"],s=function(){var t=function(t,e,i,s,o){this.timer=t,this.initialDomain=e,this.tweenTime=i,this.onBrush=new r.Signal,this.margin={top:10,right:20,bottom:0,left:o.left},this.height=50-this.margin.top-this.margin.bottom+20,this.currentTime=this.timer.time,this.x=n.time.scale().range([0,s]),this.x.domain([0,this.timer.totalDuration]),this.xDisplayed=n.time.scale().range([0,s]),this.xDisplayed.domain(this.initialDomain),this.xAxis=n.svg.axis().scale(this.x).orient("top").tickSize(-5,0).tickFormat(a.formatMinutes),this.svg=n.select(".timeline__header").append("svg").attr("width",s+this.margin.left+this.margin.right).attr("height",56),this.svgContainer=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.createBrushHandle(),this.createTimeHandle(),this.timer.durationChanged.add(this.onDurationChanged)};return t.prototype.adaptDomainToDuration=function(t,e){var i=1e3*e,n=[t[0],t[1]];return n[0]=Math.min(n[0],i),n[1]=Math.min(n[1],i),n[0]=Math.max(n[0],0),n},t.prototype.setDomain=function(){this.brush.x(this.x).extent(this.initialDomain),this.svgContainer.select(".brush").call(this.brush),this.onBrush.dispatch(this.initialDomain),this.render(),this.xDisplayed.domain(this.initialDomain)},t.prototype.onDurationChanged=function(t){this.x.domain([0,this.timer.totalDuration]),this.xAxisElement.call(this.xAxis),this.initialDomain=this.adaptDomainToDuration(this.initialDomain,t),this.setDomain(this.initialDomain)},t.prototype.createBrushHandle=function(){var t=this;this.xAxisElement=this.svgContainer.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.margin.top+7)+")").call(this.xAxis);var e=function(){var e=t.brush.extent(),i=e[0].getTime(),n=e[1].getTime();t.initialDomain[0]=i,t.initialDomain[1]=n,t.setDomain(t.initialDomain)};this.brush=n.svg.brush().x(this.x).extent(this.initialDomain).on("brush",e),this.gBrush=this.svgContainer.append("g").attr("class","brush").call(this.brush).selectAll("rect").attr("height",20)},t.prototype.render=function(){var t=this.svgContainer.selectAll(".time-indicator");t.attr("transform","translate("+this.xDisplayed(this.currentTime[0])+", 25)")},t.prototype.createTimeHandle=function(){var t=this,e=function(){var e=n.event.sourceEvent;e.stopPropagation();var i=t.tweenTime,r=null!=e.x?e.x:e.clientX,s=t.xDisplayed.invert(r-t.margin.left);s=s.getTime(),s=Math.max(0,s);var o=!1;e.shiftKey&&(time=s/1e3,o=a.getClosestTime(i.data,time,"---non-existant"),o!==!1&&(o=1e3*o)),o===!1&&(o=s),t.timer.seek([o])},i=n.behavior.drag().origin(function(t){return t}).on("drag",e),r=this.svgContainer.selectAll(".time-indicator").data(this.currentTime);r.enter().append("rect").attr("x",0).attr("y",20).attr("width",t.xDisplayed(t.timer.totalDuration)).attr("height",50).attr("fill-opacity",0).on("click",function(){var e=n.mouse(this),i=t.xDisplayed.invert(e[0]);i=i.getTime(),i=Math.max(0,i),t.timer.seek([i])});var s=r.enter().append("g").attr("class","time-indicator").attr("transform","translate(-0.5,30)").call(i);s.append("rect").attr("class","time-indicator__line").attr("x",-.5).attr("y",0).attr("width",1).attr("height",1e3),s.append("path").attr("class","time-indicator__handle").attr("d","M -5 -3 L -5 5 L 0 10 L 5 5 L 5 -3 L -5 -3"),this.svgContainer.append("rect").attr("class","graph-mask").attr("x",-t.margin.left).attr("y",-t.margin.top).attr("width",t.margin.left-5).attr("height",t.height)},t.prototype.resize=function(t){t=t-this.margin.left-this.margin.right,this.svg.attr("width",t+this.margin.left+this.margin.right),this.x.range([0,t]),this.xDisplayed.range([0,t]),this.xAxisElement.call(this.xAxis)},t}();e["default"]=s},function(t,e){"use strict";var i=function(){var t=function(t,e){this.timeline=t,this.container=e,this.timeSelection=this.container.selectAll(".time-indicator").data(this.timeline.currentTime);var i=this.timeSelection.enter().append("svg").attr("class","time-indicator timeline__right-mask").attr("width",window.innerWidth-this.timeline.label_position_x).attr("height",442);this.timeSelection=i.append("rect").attr("class","time-indicator__line").attr("x",-1).attr("y",-this.timeline.margin.top-5).attr("width",1).attr("height",1e3)};return t.prototype.render=function(){this.timeSelection=this.container.selectAll(".time-indicator rect"),this.timeSelection.attr("x",this.timeline.x(this.timeline.currentTime[0])-.5)},t}();e["default"]=i},function(t,e,i){"use strict";var n=i(14),r=i(12),a=i(1),s=i(2)["default"],o=function(){var t=function(t,e){this.timeline=t,this.container=e,this.dy=10+this.timeline.margin.top,this.onUpdate=new r.Signal};return t.prototype.render=function(){var t=this,e=t.timeline.tweenTime,i=function(){t.timeline.selectionManager.select(this)},r=function(e){var i=t.timeline.x.invert(n.event.x).getTime()/1e3,r=i-e.start;if(e.start+=r,e.end+=r,e.properties)for(var a=0;a<e.properties.length;a++)for(var s=e.properties[a],o=0;o<s.keys.length;o++){var l=s.keys[o];l.time+=r}e._isDirty=!0,t.onUpdate.dispatch()},o=function(i){n.event.sourceEvent.stopPropagation();var r=n.event.sourceEvent,a=t.timeline.x.invert(n.event.x).getTime()/1e3,o=!1;if(r.shiftKey&&(o=s.getClosestTime(e.data,a,i.id,!1,e.timer)),!o){var l=a-i.start;o=i.start+l}i.start=o,i._isDirty=!0,t.onUpdate.dispatch()},l=function(i){n.event.sourceEvent.stopPropagation();var r=n.event.sourceEvent,a=t.timeline.x.invert(n.event.x).getTime()/1e3,o=!1;if(r.shiftKey&&(o=s.getClosestTime(e.data,a,!1,!1,e.timer)),!o){var l=a-i.end;o=i.end+l}i.end=o,i._isDirty=!0,t.onUpdate.dispatch()},c=n.behavior.drag().origin(function(){var t=n.select(this);return{x:t.attr("x"),y:t.attr("y")}}).on("drag",o),u=n.behavior.drag().origin(function(){var t=n.select(this);return{x:t.attr("x"),y:t.attr("y")}}).on("drag",l),h=n.behavior.drag().origin(function(){var t=n.select(this);return{x:t.attr("x"),y:t.attr("y")}}).on("drag",r),p=1,d=this.container.selectAll(".line-grp").data(this.timeline.tweenTime.data,function(t){return t.id}),f=d.enter().append("g").attr("class","line-grp"),m=f.append("svg").attr("class","timeline__right-mask").attr("width",window.innerWidth-t.timeline.label_position_x).attr("height",t.timeline.lineHeight);m.append("rect").attr("class","bar").attr("id",function(){return s.guid()}).attr("y",3).attr("height",14),m.append("rect").attr("class","bar-anchor bar-anchor--left").attr("y",2).attr("height",16).attr("width",6).call(c),m.append("rect").attr("class","bar-anchor bar-anchor--right").attr("y",2).attr("height",16).attr("width",6).call(u),t.dy=10+this.timeline.margin.top,d.attr("transform",function(e){var i=t.dy;if(t.dy+=t.timeline.lineHeight,!e.collapsed){var n=0;if(e.properties){var r=a.filter(e.properties,function(t){return t.keys.length});n=r.length}t.dy+=n*t.timeline.lineHeight}return"translate(0,"+i+")"});var v=function(t){return null!=t.start&&null!=t.end?!0:!1};d.selectAll(".bar-anchor--left").filter(v).attr("x",function(e){return t.timeline.x(1e3*e.start)-1}).on("mousedown",function(){n.event.stopPropagation()}),d.selectAll(".bar-anchor--right").filter(v).attr("x",function(e){return t.timeline.x(1e3*e.end)-1}).on("mousedown",function(){n.event.stopPropagation()}),d.selectAll(".bar").filter(v).attr("x",function(e){return t.timeline.x(1e3*e.start)+p}).attr("width",function(e){return Math.max(0,1e3*(t.timeline.x(e.end)-t.timeline.x(e.start))-p)}).call(h).on("click",i).on("mousedown",function(){n.event.stopPropagation()}),f.append("text").attr("class","line-label").attr("x",t.timeline.label_position_x+10).attr("y",16).text(function(t){return t.label}).on("click",i).on("mousedown",function(){n.event.stopPropagation()});var t=this;return f.append("text").attr("class","line__toggle").attr("x",t.timeline.label_position_x-10).attr("y",16).on("click",function(e){e.collapsed=!e.collapsed,t.onUpdate.dispatch()}),d.selectAll(".line__toggle").text(function(t){return t.collapsed?"▸":"▾"}),f.append("line").attr("class","line-separator").attr("x1",-t.timeline.margin.left).attr("x2",t.timeline.x(t.timeline.timer.totalDuration+100)).attr("y1",t.timeline.lineHeight).attr("y2",t.timeline.lineHeight),d.exit().remove(),d},t}();e["default"]=o},function(t,e,i){"use strict";var n=i(14),r=function(){var t=function(t,e){this.timeline=t,this.container=e};return t.prototype.render=function(t){var e=this,i=function(t){return t.properties?t.properties:[]},r=function(t){return t.name},a=t.selectAll(".keys-preview").data(i,r);a.enter().append("svg").attr("class","keys-preview timeline__right-mask").attr("width",window.innerWidth-e.timeline.label_position_x).attr("height",e.timeline.lineHeight);var s=function(){var t=n.select(this.parentNode.parentNode),e=t.datum();return e.collapsed===!0?"":"display: none;"};a.selectAll(".key--preview").attr("style",s);var o=function(t){return t.keys},l=function(t){return t.time},c=a.selectAll(".key--preview").data(o,l);c.enter().append("path").attr("class","key--preview").attr("style",s).attr("d","M 0 -4 L 4 0 L 0 4 L -4 0"),c.attr("transform",function(t){var i=e.timeline.x(1e3*t.time);i=parseInt(i,10);var n=11;return"translate("+i+","+n+")"}),c.exit().remove()},t}();e["default"]=r},function(t,e,i){"use strict";var n=i(14),r=i(12),a=i(2)["default"],s=function(){var t=function(t){this.timeline=t,this.onKeyAdded=new r.Signal,this.subGrp=!1};return t.prototype.render=function(t){var e=this,i=this,r=function(t){return t.properties?t.properties:[]},s=function(t){return t.name},o=function(t){return t.keys.length},l=t.selectAll(".line-item").data(r,s),c=l.enter().append("g").filter(o).attr("class","line-item");return i.subGrp=c,l.filter(o).attr("transform",function(t,e){var n=(e+1)*i.timeline.lineHeight;return"translate(0,"+n+")"}),c.append("rect").attr("class","click-handler click-handler--property").attr("x",0).attr("y",0).attr("width",i.timeline.x(i.timeline.timer.totalDuration+100)).attr("height",i.timeline.lineHeight).on("dblclick",function(t){var r=e.parentNode.parentNode,s=n.select(r).datum(),o=t["default"]?t["default"]:0,l=n.mouse(e),c=i.timeline.x.invert(l[0]);c=c.getTime()/1e3;var u=a.getPreviousKey(t.keys,c);u&&(o=u.val);var h={time:c,val:o};t.keys.push(h),t.keys=a.sortKeys(t.keys),s._isDirty=!0,keyContainer=e.parentNode,i.onKeyAdded.dispatch(h,keyContainer)}),c.append("svg").attr("class","line-item__keys timeline__right-mask").attr("width",window.innerWidth-i.timeline.label_position_x).attr("height",i.timeline.lineHeight).attr("fill","#f00"),c.append("text").attr("class","line-label line-label--small").attr("x",i.timeline.label_position_x+10).attr("y",15).text(function(t){return t.name}),c.append("line").attr("class","line-separator--secondary").attr("x1",-i.timeline.margin.left).attr("x2",i.timeline.x(i.timeline.timer.totalDuration+100)).attr("y1",i.timeline.lineHeight).attr("y2",i.timeline.lineHeight),t.selectAll(".line-item").attr("display",function(){var t=this.parentNode,e=n.select(t).datum();return e.collapsed?"none":"block"}),l},t}();e["default"]=s},function(t,e,i){"use strict";var n=i(14),r=i(12),a=i(2)["default"],s=i(1),o=function(){var t=function(t){this.timeline=t,this.onKeyUpdated=new r.Signal};return t.prototype.selectNewKey=function(t,e){var i=this,r=n.select(e).selectAll(".key").filter(function(e){return e.time===t.time});r.length&&(n.selectAll(".key--selected").classed("key--selected",!1),r.classed("key--selected",!0),r=r[0][0],i.timeline.selectionManager.select(r))},t.prototype.render=function(t){var e=this,i=e.timeline.tweenTime,r=function(t){var r=this,o=n.event.sourceEvent,l=this.parentNode,c=l.parentNode.parentNode,u=n.select(l).datum(),h=n.select(c).datum(),p=e.timeline.x.domain()[0],d=n.mouse(this),f=t.time,m=e.timeline.x.invert(d[0]);m=m.getTime(),m=m/1e3-p/1e3,m=t.time+m;var v=e.timeline.selectionManager.getSelection(),g=!1,y=!1;v.length&&(g=n.select(v[0]).datum().time,y=n.select(v[v.length-1]).datum().time),v=s.filter(v,function(t){return t.isEqualNode(r)===!1});var b=!1;o.shiftKey&&(b=a.getClosestTime(i.data,m,h.id,u.name,i.timer)),b===!1&&(b=m),t.time=b,u.keys=a.sortKeys(u.keys);var _=t.time-f,x=function(t){var e=t.parentNode,i=n.select(e).datum(),r=e.parentNode.parentNode,s=n.select(r).datum();s._isDirty=!0,i.keys=a.sortKeys(i.keys)},w=!1,k=!1;if(v.length){o.altKey&&null!=g&&null!=y&&(k=g===f,w=k?(y-t.time)/(y-f):(t.time-g)/(f-g));for(var T=0;T<v.length;T++){var D=v[T];data=n.select(D).datum(),w===!1?data.time+=_:data.time=k?y-(y-data.time)*w:g+(data.time-g)*w,x(D)}}h._isDirty=!0,e.onKeyUpdated.dispatch()},o=function(t){return t.keys},l=function(t){return t._id||(t._id=a.guid()),t._id},c=t.select(".line-item__keys").selectAll(".key").data(o,l),u=function(){var t=n.event;t.sourceEvent&&(t=t.sourceEvent);var i=t.shiftKey;n.event.type&&"dragstart"===n.event.type&&n.select(this).classed("key--selected")||e.timeline.selectionManager.select(this,i)},h=function(){e.timeline.editor.undoManager.addState()},p=n.behavior.drag().origin(function(t){return t}).on("drag",r).on("dragstart",u).on("dragend",h),d=c.enter().append("g").attr("class","key").attr("id",function(t){return t._id}).on("mousedown",function(){n.event.stopPropagation()}).call(p);t.selectAll(".key").attr("class",function(t){var e="key";if(n.select(this).classed("key--selected")&&(e+=" key--selected"),t.ease){var i=t.ease.split(".");2===i.length&&(e+=" "+i[1])}else e+=" easeOut";return e});var f=d.append("g").attr("class","ease-linear");f.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L 6 0 L 0 6"),f.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L -6 0 L 0 6");var m=d.append("g").attr("class","ease-in");m.append("path").attr("class","key__shape-rect").attr("d","M 0 -6 L 0 6 L 4 5 L 1 0 L 4 -5"),m.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L -6 0 L 0 6");var v=d.append("g").attr("class","ease-out");v.append("path").attr("class","key__shape-rect").attr("d","M 0 -6 L 0 6 L -4 5 L -1 0 L -4 -5"),v.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L 6 0 L 0 6");var g=d.append("g").attr("class","ease-inout");g.append("circle").attr("cx",0).attr("cy",0).attr("r",5),c.attr("transform",function(t){var i=e.timeline.x(1e3*t.time);i=parseInt(i,10);var n=10;return"translate("+i+","+n+")"}),c.exit().remove()},t}();e["default"]=o},function(t,e){"use strict";var i=function(){var t=function(t){this.timeline=t};return t.prototype.render=function(t){var e=this,i=e.timeline.properties.subGrp,n=function(t){return null!=t.errors};i.insert("svg",":first-child").attr("class","line-item__errors").attr("width",window.innerWidth-e.timeline.label_position_x).attr("height",e.timeline.lineHeight);var r=function(t){return t.errors},a=function(t){return t.time},s=t.filter(n).select(".line-item__errors").selectAll(".error").data(r,a);s.enter().append("rect").attr("class","error").attr("width",4).attr("height",e.timeline.lineHeight-1).attr("y","1"),t.selectAll(".error").attr("x",function(t){var i;return i=e.timeline.x(1e3*t.time)}),s.exit().remove()},t}();e["default"]=i},function(t,e){"use strict";var i=function(){var t=function(t,e,i){this.timeline=t,this.svg=e,this.margin=i,this.onMouseUp=this.onMouseUp.bind(this),this.init()};return t.prototype.onMouseUp=function(){this.svg.selectAll(".selection").remove(),$("body").css({"user-select":"all"})},t.prototype.init=function(){var t=this;this.svg.on("mousedown",function(){var e=d3.mouse(this);t.svg.append("rect").attr({"class":"selection",x:e[0],y:e[1],width:0,height:0}),t.timeline.selectionManager.reset(),$("body").css({"user-select":"none"})
}).on("mousemove",function(){var e=t.svg.select(".selection");if(!e.empty()){var i=d3.mouse(this),n={x:parseInt(e.attr("x"),10),y:parseInt(e.attr("y"),10),width:parseInt(e.attr("width"),10),height:parseInt(e.attr("height"),10)};i[0]=Math.max(t.margin.left,i[0]);var r={x:i[0]-n.x,y:i[1]-n.y};r.x<1||2*r.x<n.width?(n.x=i[0],n.width-=r.x):n.width=r.x,r.y<1||2*r.y<n.height?(n.y=i[1],n.height-=r.y):n.height=r.y,e.attr(n),n.x-=t.margin.left;var a=6;n.timeStart=t.timeline.x.invert(n.x-a).getTime()/1e3,n.timeEnd=t.timeline.x.invert(n.x+n.width+a).getTime()/1e3;var s=t.svg[0][0].getBoundingClientRect();d3.selectAll(".key--selected").classed("key--selected",!1),t.timeline.selectionManager.reset();var o=[];d3.selectAll(".key").each(function(t){var e=d3.select(this.parentNode.parentNode.parentNode).datum();if(e.collapsed!==!0){var i=d3.select(this)[0][0].getBoundingClientRect(),r=i.top-s.top;t.time>=n.timeStart&&t.time<=n.timeEnd&&(r>=n.y&&r<=n.y+n.height||r+10>=n.y&&r+10<=n.y+n.height)&&(d3.select(this).classed("key--selected",!0),o.push(this))}}),t.timeline.selectionManager.select(o)}}),$(window).on("mouseup",this.onMouseUp)},t}();e["default"]=i},function(t,e,i){"use strict";var n=i(12),r=i(28)["default"],a=i(29)["default"],s=i(30)["default"],o=function(){var t=function(t,e,i){this.editor=t,this.$el=e,this.onKeyAdded=this.onKeyAdded.bind(this),this.timeline=t.timeline,this.timer=t.timer,this.selectionManager=t.selectionManager,this.keyAdded=new n.Signal,this.items=[],this.numberProp=!1,this.tweenProp=!1;var r=d3.select(i),a=!1,s=!1,o=!1,l=!1,c=!1;r.classed("key")&&(s=i.parentNode,l=s.parentNode.parentNode,c=d3.select(l).datum(),o=d3.select(s).datum(),a=r.datum()),r.classed("bar")&&(c=r.datum()),r.classed("line-label")&&(i=i.parentNode,r=d3.select(i),c=r.datum());var u=!1;o&&(u=o.name);var h=this.getContainer(c),p=h;for(var d in c.properties){var f=c.properties[d];if(!u||f.name===u){var m=this.getGroupContainer(f,h),v=this.addNumberProperty(f,c,a,m);this.items.push(v),f.name===u&&(p=m)}}if(u){var g=this.addTweenProperty(f,c,a,p,o,i);this.items.push(g)}};return t.prototype.onKeyAdded=function(){this.keyAdded.dispatch()},t.prototype.getGroupContainer=function(t,e){var i,n,r;if(t.group){var a=t.group.replace(/\s+/g,"-").toLowerCase();return r="property-grp--"+a,i=e.find("."+r),i.length?i:(n=this.createGroupContainer(r,t.group),e.append(n),n)}return r="property-grp--general",i=e.find("."+r),i.length?i:(n=this.createGroupContainer(r),e.append(n),n)},t.prototype.createGroupContainer=function(t,e){void 0===e&&(e=!1);var i=$('<div class="property-grp '+t+'"></div>');return e&&i.append('<h3 class="property-grp__title">'+e+"</h3>"),i},t.prototype.getContainer=function(t){var e=!1;return t.id&&(e=$("#property--"+t.id),e.length||(e=e=$('<div class="properties__wrapper" id="property--'+t.id+'"></div>'),this.$el.append(e),t.label&&e.append('<h2 class="properties-editor__title">'+t.label+"</h2>"))),e===!1&&(e=$('<div class="properties__wrapper" id="no-item"></div>'),this.$el.append(e)),e},t.prototype.addNumberProperty=function(t,e,i,n){var s=r;t.type&&"color"===t.type&&(s=a);var o=new s(t,e,this.editor,i);return o.keyAdded.add(this.onKeyAdded),n.append(o.$el),o},t.prototype.addTweenProperty=function(t,e,i,n,r,a){var o=this,l=new s(t,e,this.editor,i,this.timeline);return n.append(l.$el),l.$el.find("[data-action-remove]").click(function(t){t.preventDefault();var n=r.keys.indexOf(i);return n>-1?(r.keys.splice(n,1),o.editor.propertiesEditor.keyRemoved.dispatch(a),e._isDirty=!0):void 0}),l},t.prototype.update=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t];e.update()}},t}();e["default"]=o},function(t,e,i){var n=i(37);t.exports=function(){var t=new n.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.b('<div class="properties-editor">'),n.b("\n"+i),n.b('  <a href="#" class="menu-item menu-item--toggle-side" data-action="toggle"><i class="icon-toggle"></i></a>'),n.b("\n"+i),n.b('  <div class="properties-editor__main"></div>'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="properties-editor">\n  <a href="#" class="menu-item menu-item--toggle-side" data-action="toggle"><i class="icon-toggle"></i></a>\n  <div class="properties-editor__main"></div>\n</div>\n',n);return t.render.apply(t,arguments)}},function(t,e,i){var n,r;(function(t){"use strict";var a=a||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,i=function(){return t.URL||t.webkitURL||t},n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,a=function(i){var n=e.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},s=t.webkitRequestFileSystem,o=t.requestFileSystem||s||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},c="application/octet-stream",u=0,h=10,p=function(e){var n=function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()};t.chrome?n():setTimeout(n,h)},d=function(t,e,i){e=[].concat(e);for(var n=e.length;n--;){var r=t["on"+e[n]];if("function"==typeof r)try{r.call(t,i||t)}catch(a){l(a)}}},f=function(e,l){var h,f,m,v=this,g=e.type,y=!1,b=function(){d(v,"writestart progress write writeend".split(" "))},_=function(){if((y||!h)&&(h=i().createObjectURL(e)),f)f.location.href=h;else{var n=t.open(h,"_blank");void 0==n&&"undefined"!=typeof safari&&(t.location.href=h)}v.readyState=v.DONE,b(),p(h)},x=function(t){return function(){return v.readyState!==v.DONE?t.apply(this,arguments):void 0}},w={create:!0,exclusive:!1};return v.readyState=v.INIT,l||(l="download"),r?(h=i().createObjectURL(e),n.href=h,n.download=l,a(n),v.readyState=v.DONE,b(),void p(h)):(t.chrome&&g&&g!==c&&(m=e.slice||e.webkitSlice,e=m.call(e,0,e.size,c),y=!0),s&&"download"!==l&&(l+=".download"),(g===c||s)&&(f=t),o?(u+=e.size,void o(t.TEMPORARY,u,x(function(t){t.root.getDirectory("saved",w,x(function(t){var i=function(){t.getFile(l,w,x(function(t){t.createWriter(x(function(i){i.onwriteend=function(e){f.location.href=t.toURL(),v.readyState=v.DONE,d(v,"writeend",e),p(t)},i.onerror=function(){var t=i.error;t.code!==t.ABORT_ERR&&_()},"writestart progress write abort".split(" ").forEach(function(t){i["on"+t]=v["on"+t]}),i.write(e),v.abort=function(){i.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),_)}),_)};t.getFile(l,{create:!1},x(function(t){t.remove(),i()}),x(function(t){t.code===t.NOT_FOUND_ERR?i():_()}))}),_)}),_)):void _())},m=f.prototype,v=function(t,e){return new f(t,e)};return m.abort=function(){var t=this;t.readyState=t.DONE,d(t,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,v}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof t&&null!==t?t.exports=a:null!==i(38)&&null!=i(39)&&(n=[],r=function(){return a}.apply(e,n),!(void 0!==r&&(t.exports=r)))}).call(e,i(40)(t))},function(t,e,i){"use strict";var n=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.__proto__=e},r=i(15),a=i(33)["default"],s=i(31),o=i(34),l=function(t){var e=function(e,i,n,r){void 0===r&&(r=!1),t.call(this,e,i,n,r),this.onInputChange=this.onInputChange.bind(this),this.$input=this.$el.find("input")};return n(e,t),e.prototype.getInputVal=function(){return parseFloat(this.$el.find("input").val())},e.prototype.render=function(){var e=this;t.prototype.render.call(this);var i=this.getCurrentVal();data={id:this.instance_property.name,label:this.instance_property.label||this.instance_property.name,val:i};var n=o(data);this.$el=r(n),this.$el.find(".property__key").click(this.onKeyClick);var a=this.$el.find("input"),l=function(){e.editor.undoManager.addState()},c={changeCallback:function(){return e.onInputChange()},endCallback:function(){return l()}};"min"in this.instance_property&&(c.min=this.instance_property.min),"max"in this.instance_property&&(c.max=this.instance_property.max);var u=new s(a.get(0),c);a.data("draggable",u),a.change(this.onInputChange)},e.prototype.update=function(){t.prototype.update.call(this);var e=this.getCurrentVal(),i=this.$input.data("draggable");i?i.set(e.toFixed(3)):this.$input.val(e.toFixed(3))},e}(a);e["default"]=l},function(t,e,i){"use strict";var n=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.__proto__=e},r=i(15);i(32);var a=i(33)["default"],s=i(35),o=function(t){var e=function(e,i,n,r){void 0===r&&(r=!1),t.call(this,e,i,n,r),this.onInputChange=this.onInputChange.bind(this),this.$input=this.$el.find("input")};return n(e,t),e.prototype.render=function(){var e=this;t.prototype.render.call(this);var i=this.getCurrentVal();data={id:this.instance_property.name,label:this.instance_property.label||this.instance_property.name,val:i};var n=s(data);this.$el=r(n),this.$el.find(".property__key").click(this.onKeyClick);var a=this.$el.find("input");a.spectrum({allowEmpty:!1,showAlpha:!0,clickoutFiresChange:!1,preferredFormat:"rgb",change:function(){e.editor.undoManager.addState()},move:function(t){e.$input.val(1==t._a?t.toHexString():t.toRgbString()),e.onInputChange()}}),a.change(this.onInputChange)},e.prototype.update=function(){t.prototype.update.call(this);var e=this.getCurrentVal();this.$input.val(e),this.$input.spectrum("set",e)},e}(a);e["default"]=o},function(t,e,i){"use strict";var n=i(15),r=i(36),a=function(){var t=function(t,e,i,n,r){void 0===n&&(n=!1),this.instance_property=t,this.lineData=e,this.editor=i,this.key_val=n,this.timeline=r,this.onChange=this.onChange.bind(this),this.timer=this.editor.timer,this.$time=!1,this.render()};return t.prototype.render=function(){var t=this,e=this;this.key_val.ease||(this.key_val.ease="Quad.easeOut");for(var i={id:this.instance_property.name+"_tween",val:this.key_val.ease,time:this.key_val.time.toFixed(3),options:["Linear.easeNone"],selected:function(){return this.toString()===e.key_val.ease?"selected":""}},a=["Quad","Cubic","Quart","Quint","Strong"],s=0;s<a.length;s++){var o=a[s];i.options.push(o+".easeOut"),i.options.push(o+".easeIn"),i.options.push(o+".easeInOut")}this.$el=n(r(i)),this.$time=this.$el.find(".property__key-time strong"),this.$time.keypress(function(e){13==e.charCode&&(e.preventDefault(),t.$time.blur(),t.updateKeyTime(t.$time.text()))}),this.$time.on("click",function(){return document.execCommand("selectAll",!1,null)}),this.$el.find("select").change(this.onChange)},t.prototype.updateKeyTime=function(t){t=parseFloat(t),isNaN(t)&&(t=this.key_val.time),this.$time.text(t),this.key_val.time=t,this.onChange()},t.prototype.onChange=function(){var t=this.$el.find("select").val();this.key_val.ease=t,this.editor.undoManager.addState(),this.lineData._isDirty=!0,this.timeline._isDirty=!0},t.prototype.update=function(){this.$time.html(this.key_val.time.toFixed(3))},t}();e["default"]=a},function(t){t.exports=r},function(t){t.exports=a},function(t,e,i){"use strict";var n=i(12),r=i(1),a=i(2)["default"],s=function(){var t=function(t,e,i,r){void 0===r&&(r=!1),this.instance_property=t,this.lineData=e,this.editor=i,this.key_val=r,this.onInputChange=this.onInputChange.bind(this),this.onKeyClick=this.onKeyClick.bind(this),this.timer=i.timer,this.keyAdded=new n.Signal,this.render(),this.$key=this.$el.find(".property__key")};return t.prototype.onKeyClick=function(t){t.preventDefault();var e=this.getCurrentVal();this.addKey(e)},t.prototype.getInputVal=function(){return this.$el.find("input").val()},t.prototype.getCurrentVal=function(){var t=this.instance_property.val,e=this.instance_property.name;return this.key_val?this.key_val.val:null!=this.lineData.values&&this.lineData.values[e]?this.lineData.values[e]:t},t.prototype.onInputChange=function(){var t=this.getInputVal(),e=this.timer.getCurrentTime()/1e3;if(this.key_val&&(e=this.key_val.time),this.instance_property.keys&&this.instance_property.keys.length){var i=r.find(this.instance_property.keys,function(t){return t.time==e});i?i.val=t:this.addKey(t)}else this.instance_property.val=t,this.lineData.values[function(t){return t.instance_property.name()}]=t,this.lineData.object&&(e=function(t){return t.timer.getCurrentTime()}/1e3,this.lineData.object.update(e-this.lineData.start));return this.lineData._isDirty=!0},t.prototype.getCurrentKey=function(){var t=this.timer.getCurrentTime()/1e3;if(!this.instance_property||!this.instance_property.keys)return!1;if(0===this.instance_property.keys.length)return!1;for(var e=0;e<this.instance_property.keys.length;e++){var i=this.instance_property.keys[e];if(i.time===t)return i}return!1},t.prototype.addKey=function(t){var e=this.timer.getCurrentTime()/1e3,i={time:e,val:t};this.instance_property.keys.push(i),this.instance_property.keys=a.sortKeys(this.instance_property.keys),this.lineData._isDirty=!0,this.keyAdded.dispatch()},t.prototype.render=function(){this.values=null!=this.lineData.values?this.lineData.values:{}},t.prototype.update=function(){var t=this.getCurrentKey();this.$key.toggleClass("property__key--active",t)},t}();e["default"]=s},function(t,e,i){var n=i(37);t.exports=function(){var t=new n.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--number">'),n.b("\n"+i),n.b('  <button class="property__key"></button>'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",t,e,0))),n.b('" class="property__label">'),n.b(n.v(n.f("label",t,e,0))),n.b("</label>"),n.b("\n"+i),n.b('  <input type="number" id="'),n.b(n.v(n.f("id",t,e,0))),n.b('" class="property__input" value="'),n.b(n.v(n.f("val",t,e,0))),n.b('" />'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="property property--number">\n  <button class="property__key"></button>\n  <label for="{{id}}" class="property__label">{{label}}</label>\n  <input type="number" id="{{id}}" class="property__input" value="{{val}}" />\n</div>\n',n);return t.render.apply(t,arguments)}},function(t,e,i){var n=i(37);t.exports=function(){var t=new n.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--number">'),n.b("\n"+i),n.b('  <button class="property__key"></button>'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",t,e,0))),n.b('" class="property__label">'),n.b(n.v(n.f("label",t,e,0))),n.b("</label>"),n.b("\n"+i),n.b('  <input id="'),n.b(n.v(n.f("id",t,e,0))),n.b('" class="property__input" value="'),n.b(n.v(n.f("val",t,e,0))),n.b('" />'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="property property--number">\n  <button class="property__key"></button>\n  <label for="{{id}}" class="property__label">{{label}}</label>\n  <input id="{{id}}" class="property__input" value="{{val}}" />\n</div>\n',n);return t.render.apply(t,arguments)}},function(t,e,i){var n=i(37);t.exports=function(){var t=new n.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--tween">'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",t,e,0))),n.b('" class="property__label">easing</label>'),n.b("\n"+i),n.b('  <div class="property__select">'),n.b("\n"+i),n.b('    <div class="custom-select">'),n.b("\n"+i),n.b('      <select id="'),n.b(n.v(n.f("id",t,e,0))),n.b('">'),n.b("\n"+i),n.s(n.f("options",t,e,1),t,e,0,212,279,"{{ }}")&&(n.rs(t,e,function(t,e,n){n.b('        <option value="'),n.b(n.v(n.d(".",t,e,0))),n.b('" '),n.b(n.v(n.f("selected",t,e,0))),n.b(">"),n.b(n.v(n.d(".",t,e,0))),n.b("</option>"),n.b("\n"+i)}),t.pop()),n.b("      </select>"),n.b("\n"+i),n.b("    </div>"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b("</div>"),n.b("\n"+i),n.b('<div class="properties-editor__actions actions">'),n.b("\n"+i),n.b('  <span class="property__key-time">key at <strong class="property__key-input" contenteditable="true">'),n.b(n.v(n.f("time",t,e,0))),n.b("</strong> seconds</span>"),n.b("\n"+i),n.b('  <a href="#" class="actions__item" data-action-remove>Remove key</a>'),n.b("\n"+i),n.b("</div>"),n.fl()},partials:{},subs:{}},'<div class="property property--tween">\n  <label for="{{id}}" class="property__label">easing</label>\n  <div class="property__select">\n    <div class="custom-select">\n      <select id="{{id}}">\n        {{#options}}\n        <option value="{{.}}" {{selected}}>{{.}}</option>\n        {{/options}}\n      </select>\n    </div>\n  </div>\n</div>\n<div class="properties-editor__actions actions">\n  <span class="property__key-time">key at <strong class="property__key-input" contenteditable="true">{{time}}</strong> seconds</span>\n  <a href="#" class="actions__item" data-action-remove>Remove key</a>\n</div>',n);return t.render.apply(t,arguments)}},function(t,e,i){"use strict";var n=i(41);n.Template=i(42).Template,n.template=n.Template,t.exports=n},function(t){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";!function(t){function e(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function i(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function n(t,e,i){if(e.charAt(i)!=t.charAt(0))return!1;for(var n=1,r=t.length;r>n;n++)if(e.charAt(i+n)!=t.charAt(n))return!1;return!0}function r(e,i,n,o){var l=[],c=null,u=null,h=null;for(u=n[n.length-1];e.length>0;){if(h=e.shift(),u&&"<"==u.tag&&!(h.tag in x))throw new Error("Illegal content in < super tag.");if(t.tags[h.tag]<=t.tags.$||a(h,o))n.push(h),h.nodes=r(e,h.tag,n,o);else{if("/"==h.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+h.n);if(c=n.pop(),h.n!=c.n&&!s(h.n,c.n,o))throw new Error("Nesting error: "+c.n+" vs. "+h.n);return c.end=h.i,l}"\n"==h.tag&&(h.last=0==e.length||"\n"==e[0].tag)}l.push(h)}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return l}function a(t,e){for(var i=0,n=e.length;n>i;i++)if(e[i].o==t.n)return t.tag="#",!0}function s(t,e,i){for(var n=0,r=i.length;r>n;n++)if(i[n].c==t&&i[n].o==e)return!0}function o(t){var e=[];for(var i in t)e.push('"'+c(i)+'": function(c,p,t,i) {'+t[i]+"}");return"{ "+e.join(",")+" }"}function l(t){var e=[];for(var i in t.partials)e.push('"'+c(i)+'":{name:"'+c(t.partials[i].name)+'", '+l(t.partials[i])+"}");return"partials: {"+e.join(",")+"}, subs: "+o(t.subs)}function c(t){return t.replace(y,"\\\\").replace(m,'\\"').replace(v,"\\n").replace(g,"\\r").replace(b,"\\u2028").replace(_,"\\u2029")}function u(t){return~t.indexOf(".")?"d":"f"}function h(t,e){var i="<"+(e.prefix||""),n=i+t.n+w++;return e.partials[n]={name:t.n,partials:{}},e.code+='t.b(t.rp("'+c(n)+'",c,p,"'+(t.indent||"")+'"));',n}function p(t,e){e.code+="t.b(t.t(t."+u(t.n)+'("'+c(t.n)+'",c,p,0)));'}function d(t){return"t.b("+t+");"}var f=/\S/,m=/\"/g,v=/\n/g,g=/\r/g,y=/\\/g,b=/\u2028/,_=/\u2029/;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(r,a){function s(){y.length>0&&(b.push({tag:"_t",text:new String(y)}),y="")}function o(){for(var e=!0,i=w;i<b.length;i++)if(e=t.tags[b[i].tag]<t.tags._v||"_t"==b[i].tag&&null===b[i].text.match(f),!e)return!1;return e}function l(t,e){if(s(),t&&o())for(var i,n=w;n<b.length;n++)b[n].text&&((i=b[n+1])&&">"==i.tag&&(i.indent=b[n].text.toString()),b.splice(n,1));else e||b.push({tag:"\n"});_=!1,w=b.length}function c(t,e){var n="="+T,r=t.indexOf(n,e),a=i(t.substring(t.indexOf("=",e)+1,r)).split(" ");return k=a[0],T=a[a.length-1],r+n.length-1}var u=r.length,h=0,p=1,d=2,m=h,v=null,g=null,y="",b=[],_=!1,x=0,w=0,k="{{",T="}}";for(a&&(a=a.split(" "),k=a[0],T=a[1]),x=0;u>x;x++)m==h?n(k,r,x)?(--x,s(),m=p):"\n"==r.charAt(x)?l(_):y+=r.charAt(x):m==p?(x+=k.length-1,g=t.tags[r.charAt(x+1)],v=g?r.charAt(x+1):"_v","="==v?(x=c(r,x),m=h):(g&&x++,m=d),_=x):n(T,r,x)?(b.push({tag:v,n:i(y),otag:k,ctag:T,i:"/"==v?_-k.length:x+T.length}),y="",x+=T.length-1,m=h,"{"==v&&("}}"==T?x++:e(b[b.length-1]))):y+=r.charAt(x);return l(_,!0),b};var x={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(e){return"{code: function (c,p,i) { "+t.wrapMain(e.code)+" },"+l(e)+"}"};var w=0;t.generate=function(e,i,n){w=0;var r={code:"",subs:{},partials:{}};return t.walk(e,r),n.asString?this.stringify(r,i,n):this.makeTemplate(r,i,n)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,e,i){var n=this.makePartials(t);return n.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(n,e,this,i)},t.makePartials=function(t){var e,i={subs:{},partials:t.partials,name:t.name};for(e in i.partials)i.partials[e]=this.makePartials(i.partials[e]);for(e in t.subs)i.subs[e]=new Function("c","p","t","i",t.subs[e]);return i},t.codegen={"#":function(e,i){i.code+="if(t.s(t."+u(e.n)+'("'+c(e.n)+'",c,p,1),c,p,0,'+e.i+","+e.end+',"'+e.otag+" "+e.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(e.nodes,i),i.code+="});c.pop();}"},"^":function(e,i){i.code+="if(!t.s(t."+u(e.n)+'("'+c(e.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(e.nodes,i),i.code+="};"},">":h,"<":function(e,i){var n={partials:{},code:"",subs:{},inPartial:!0};t.walk(e.nodes,n);var r=i.partials[h(e,i)];r.subs=n.subs,r.partials=n.partials},$:function(e,i){var n={subs:{},code:"",partials:i.partials,prefix:e.n};t.walk(e.nodes,n),i.subs[e.n]=n.code,i.inPartial||(i.code+='t.sub("'+c(e.n)+'",c,p,i);')},"\n":function(t,e){e.code+=d('"\\n"'+(t.last?"":" + i"))},_v:function(t,e){e.code+="t.b(t.v(t."+u(t.n)+'("'+c(t.n)+'",c,p,0)));'},_t:function(t,e){e.code+=d('"'+c(t.text)+'"')},"{":p,"&":p},t.walk=function(e,i){for(var n,r=0,a=e.length;a>r;r++)n=t.codegen[e[r].tag],n&&n(e[r],i);return i},t.parse=function(t,e,i){return i=i||{},r(t,"",[],i.sectionTags||[])},t.cache={},t.cacheKey=function(t,e){return[t,!!e.asString,!!e.disableLambda,e.delimiters,!!e.modelGet].join("||")},t.compile=function(e,i){i=i||{};var n=t.cacheKey(e,i),r=this.cache[n];if(r){var a=r.partials;for(var s in a)delete a[s].instance;return r}return r=this.generate(this.parse(this.scan(e,i.delimiters),e,i),e,i),this.cache[n]=r}}(e)},function(t,e){"use strict";!function(t){function e(t,e,i){var n;return e&&"object"==typeof e&&(void 0!==e[t]?n=e[t]:i&&e.get&&"function"==typeof e.get&&(n=e.get(t))),n}function i(t,e,i,n,r,a){function s(){}function o(){}s.prototype=t,o.prototype=t.subs;var l,c=new s;c.subs=new o,c.subsText={},c.buf="",n=n||{},c.stackSubs=n,c.subsText=a;for(l in e)n[l]||(n[l]=e[l]);for(l in n)c.subs[l]=n[l];r=r||{},c.stackPartials=r;for(l in i)r[l]||(r[l]=i[l]);for(l in r)c.partials[l]=r[l];return c}function n(t){return String(null===t||void 0===t?"":t)}function r(t){return t=n(t),u.test(t)?t.replace(a,"&amp;").replace(s,"&lt;").replace(o,"&gt;").replace(l,"&#39;").replace(c,"&quot;"):t}t.Template=function(t,e,i,n){t=t||{},this.r=t.code||this.r,this.c=i,this.options=n||{},this.text=e||"",this.partials=t.partials||{},this.subs=t.subs||{},this.buf=""},t.Template.prototype={r:function(){return""},v:r,t:n,render:function(t,e,i){return this.ri([t],e||{},i)},ri:function(t,e,i){return this.r(t,e,i)},ep:function(t,e){var n=this.partials[t],r=e[n.name];if(n.instance&&n.base==r)return n.instance;if("string"==typeof r){if(!this.c)throw new Error("No compiler available.");r=this.c.compile(r,this.options)}if(!r)return null;if(this.partials[t].base=r,n.subs){e.stackText||(e.stackText={});for(key in n.subs)e.stackText[key]||(e.stackText[key]=void 0!==this.activeSub&&e.stackText[this.activeSub]?e.stackText[this.activeSub]:this.text);r=i(r,n.subs,n.partials,this.stackSubs,this.stackPartials,e.stackText)}return this.partials[t].instance=r,r},rp:function(t,e,i,n){var r=this.ep(t,i);return r?r.ri(e,i,n):""},rs:function(t,e,i){var n=t[t.length-1];if(!h(n))return void i(t,e,this);for(var r=0;r<n.length;r++)t.push(n[r]),i(t,e,this),t.pop()},s:function(t,e,i,n,r,a,s){var o;return h(t)&&0===t.length?!1:("function"==typeof t&&(t=this.ms(t,e,i,n,r,a,s)),o=!!t,!n&&o&&e&&e.push("object"==typeof t?t:e[e.length-1]),o)},d:function(t,i,n,r){var a,s=t.split("."),o=this.f(s[0],i,n,r),l=this.options.modelGet,c=null;if("."===t&&h(i[i.length-2]))o=i[i.length-1];else for(var u=1;u<s.length;u++)a=e(s[u],o,l),void 0!==a?(c=o,o=a):o="";return r&&!o?!1:(r||"function"!=typeof o||(i.push(c),o=this.mv(o,i,n),i.pop()),o)},f:function(t,i,n,r){for(var a=!1,s=null,o=!1,l=this.options.modelGet,c=i.length-1;c>=0;c--)if(s=i[c],a=e(t,s,l),void 0!==a){o=!0;break}return o?(r||"function"!=typeof a||(a=this.mv(a,i,n)),a):r?!1:""},ls:function(t,e,i,r,a){var s=this.options.delimiters;return this.options.delimiters=a,this.b(this.ct(n(t.call(e,r)),e,i)),this.options.delimiters=s,!1},ct:function(t,e,i){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(e,i)},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ms:function(t,e,i,n,r,a,s){var o,l=e[e.length-1],c=t.call(l);return"function"==typeof c?n?!0:(o=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,l,i,o.substring(r,a),s)):c},mv:function(t,e,i){var r=e[e.length-1],a=t.call(r);return"function"==typeof a?this.ct(n(a.call(r)),r,i):a},sub:function(t,e,i,n){var r=this.subs[t];r&&(this.activeSub=t,r(e,i,this,n),this.activeSub=!1)}};var a=/&/g,s=/</g,o=/>/g,l=/\'/g,c=/\"/g,u=/[&<>\"\']/,h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(e)}])});
//# sourceMappingURL=TweenTime.Editor.min.js.map